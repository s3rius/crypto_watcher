name: "Release crypto_watcher"

on:
  workflow_run:
    workflows: [ "Pre-commit check" ]
    branches: [ master ]
    types:
      - completed

jobs:
  publisher:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest

    steps:
      - name: Checkout ğŸ›
        uses: actions/checkout@master

      - name: Set up Python ğŸ—
        uses: actions/setup-python@v2
        with:
          python-version: '3.8.7'

      - name: Install python dependencies ğŸ‘¨ğŸ»â€ğŸ’»
        run: |
          pip install -U pip
          pip install poetry
          poetry install
        env:
          POETRY_VIRTUALENVS_CREATE: false

      - name: Release package ğŸ‰ğŸŠğŸ¥³ğŸŠğŸ‰
        env:
          POETRY_PYPI_TOKEN_PYPI: ${{ secrets.PYPI_TOKEN }}
        run: poetry publish --build
